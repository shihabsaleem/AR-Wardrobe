<!DOCTYPE html>
<html>
<head>
    <title>Web AR Hat Filter</title>
    <style>
        #videoElement {
            width: 100%;
            height: auto;
            transform: scaleX(-1); /* Flip video horizontally for mirroring effect */
        }
        #canvasElement {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <video id="videoElement"></video>
    <canvas id="canvasElement"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/tracking/build/tracking.js"></script>
    <script>
        const video = document.getElementById('videoElement');
        const canvas = document.getElementById('canvasElement');
        const context = canvas.getContext('2d');

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                video.srcObject = stream;
                video.play();
            })
            .catch(function (error) {
                console.error("Error accessing the camera: ", error);
            });

        const hatImage = new Image();
        hatImage.src = 'path/to/your/hat-image.png';
        hatImage.onload = function () {
            startTracking();
        };

        function startTracking() {
            const tracker = new tracking.ObjectTracker('face');
            tracker.setInitialScale(4);
            tracker.setStepSize(2);
            tracker.setEdgesDensity(0.1);

            tracking.track('#videoElement', tracker, { camera: true });

            tracker.on('track', function (event) {
                context.clearRect(0, 0, canvas.width, canvas.height);

                event.data.forEach(function (rect) {
                    context.strokeStyle = '#FF0000';
                    context.lineWidth = 2;
                    context.strokeRect(rect.x, rect.y, rect.width, rect.height);

                    const hatWidth = rect.width * 1.5;
                    const hatHeight = rect.height * 0.8;
                    const hatX = rect.x + rect.width / 2 - hatWidth / 2;
                    const hatY = rect.y - hatHeight * 0.7;

                    context.drawImage(hatImage, hatX, hatY, hatWidth, hatHeight);
                });
            });
        }
    </script>
</body>
</html>
